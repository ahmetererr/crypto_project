{% extends "base.html" %}

{% block title %}Inbox - Secure Email{% endblock %}
{% block page_title %}Inbox{% endblock %}

{% block content %}
{% if messages %}
<div class="inbox-header">
    <div class="inbox-stats">
        <span>{{ messages|length }} messages</span>
        {% set unread_count = messages|selectattr('is_read', 'equalto', False)|list|length %}
        {% if unread_count > 0 %}
        <span class="unread-badge">{{ unread_count }} unread</span>
        {% endif %}
    </div>
</div>

<div class="email-list">
    {% for msg in messages %}
    <div class="email-item {% if not msg.is_read %}unread{% endif %}" onclick="window.location='{{ url_for('read_email', message_id=msg.id) }}'">
        <div class="email-checkbox">
            <input type="checkbox" onclick="event.stopPropagation();">
        </div>
        <div class="email-content">
            <div class="email-header-row">
                <span class="email-sender">
                    {% if not msg.is_read %}<strong>{% endif %}
                    {{ msg.sender }}
                    {% if not msg.is_read %}</strong>{% endif %}
                </span>
                <span class="email-date">{{ msg.created_at }}</span>
            </div>
            <div class="email-subject-row">
                <span class="email-subject">
                    {% if not msg.is_read %}<strong>{% endif %}
                    {{ msg.subject }}
                    {% if not msg.is_read %}</strong>{% endif %}
                </span>
            </div>
        </div>
        <div class="email-actions" onclick="event.stopPropagation();">
            <a href="{{ url_for('read_email', message_id=msg.id) }}" class="action-icon" title="Read">üëÅÔ∏è</a>
            <a href="{{ url_for('reply_email', message_id=msg.id) }}" class="action-icon" title="Reply">‚Ü©Ô∏è</a>
            <a href="{{ url_for('forward_email', message_id=msg.id) }}" class="action-icon" title="Forward">‚û°Ô∏è</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <div class="empty-icon">üì≠</div>
    <h2>No messages</h2>
    <p>Your inbox is empty. Start a conversation!</p>
    <a href="{{ url_for('send_email') }}" class="btn btn-primary" style="margin-top: 16px;">Compose</a>
</div>
{% endif %}

<style>
.inbox-header {
    padding: 16px;
    border-bottom: 1px solid #e0e0e0;
    background: #fff;
}

.inbox-stats {
    font-size: 14px;
    color: #5f6368;
    display: flex;
    align-items: center;
    gap: 16px;
}

.unread-badge {
    background: #1a73e8;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

.email-list {
    background: #fff;
}

.email-item {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid #f1f3f4;
    cursor: pointer;
    transition: background 0.1s;
    gap: 12px;
}

.email-item:hover {
    background: #f8f9fa;
}

.email-item.unread {
    background: #fff;
}

.email-item.unread:hover {
    background: #f8f9fa;
}

.email-checkbox {
    width: 20px;
}

.email-checkbox input {
    cursor: pointer;
}

.email-content {
    flex: 1;
    min-width: 0;
}

.email-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 4px;
}

.email-sender {
    font-size: 14px;
    color: #202124;
    font-weight: 400;
}

.email-date {
    font-size: 12px;
    color: #5f6368;
    white-space: nowrap;
    margin-left: 16px;
}

.email-subject-row {
    display: flex;
    align-items: center;
}

.email-subject {
    font-size: 14px;
    color: #5f6368;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.email-item.unread .email-subject {
    color: #202124;
    font-weight: 500;
}

.email-actions {
    display: flex;
    gap: 8px;
    opacity: 0;
    transition: opacity 0.15s;
}

.email-item:hover .email-actions {
    opacity: 1;
}

.action-icon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    text-decoration: none;
    font-size: 16px;
    transition: background 0.15s;
}

.action-icon:hover {
    background: #f1f3f4;
}

.empty-state {
    text-align: center;
    padding: 80px 20px;
}

.empty-icon {
    font-size: 64px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-state h2 {
    font-size: 22px;
    font-weight: 400;
    color: #202124;
    margin-bottom: 8px;
}

.empty-state p {
    font-size: 14px;
    color: #5f6368;
}
</style>
{% endblock %}
